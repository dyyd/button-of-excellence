{% extends "base.html" %}

{% block scripts %}
      function newUser() {
        console.log("Starting to create new user!")
        var name = document.getElementById("uname").value;
        var type = document.getElementById("user-type").value;
        fetch("/api/v1/users?name=" + name + "&type=" + type, {
          method: "POST"
        }).then(response => {
          console.log(response.text()); // TODO: Debug logging, remove!
          console.log("New user created. Reloading"); // TODO: Debug logging, remove!
          location.reload();
        })
      }

      {% if testing %}
        function postButtonPress(id) {
          var xhr = new XMLHttpRequest();
          xhr.open('POST', "/api/v1/button?id=" + id, true);
          xhr.send();
        }
      {% endif %}
{% endblock %}

{% block content %}
    <div class="jumbotron">
      <form name="new-user-form">
        <div class="form-group">
          <label>
            Nimi
          </label>
          <input id="uname" type="text" name="username" class="form-control"></p>
        </div>
        <div class="form-group">
          <label>T端端p</label>
          <select id="user-type" class="form-control">
            <option value="1" selected="true">Student</option>
            <option value="2">Teacher</option>
          </select>
        </div>
      </form>
      <button onclick= newUser() class="btn btn-primary">
        Loo uus kasutaja
      </button>
    </div>
    <div class="container">
    {% for user in users %}

      <ul class="list-group row">
        {% if testing%}
        <li class="list-group-item col-4">
          <button onClick=postButtonPress({{user.id}})>
            Test {{user.username}}!
          </button>
        </li>
        {% else %}
        <li class="list-group-item col-6">ID: {{user.id}}</li>
        <li class="list-group-item col-6">Nimi: {{user.username}}</li>
        <li class="list-group-item col-6">T端端p: {{user.type.name}}</li>
        {% endif %}
        <br>
      </ul>
    {% endfor %}
    </div>
{% endblock %}
