{% extends "base.html" %}
{% block scripts %}
      function startSession() {
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            var id = xhr.response
            window.location = "/sessions/" + id;
          }
        }
        var e = document.getElementById("group-select");
        var groupId = e.options[e.selectedIndex].value

        var e = document.getElementById("context-select");
        var contextId = e.options[e.selectedIndex].value

        xhr.open('POST', '/sessions', true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
          groupId: groupId,
          contextId: contextId,
          description: document.getElementById("session-description").value
        }));
      }

      function showForm() {
         $("#new-session-form-group").toggle();
      }

{% endblock %}

{% block content %}
  <button type="button" class="btn btn-primary btn-lg" onclick="showForm()" style="position:absolute; top: 6rem; left: 1rem">New</button>
  <div class="container">
    <div class="row hidden jumbotron" id="new-session-form-group";>
      <form>
        <div class="form-group">
          <label>Group</label>
          <select id="group-select" class="form-control">
            {% for group in groups %}
            <option value={{group.id}}>{{group.description}}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Context</label>
          <select id="context-select" class="form-control">
            {% for context in contexts %}
            <option value={{context.id}}>{{context.name}}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Description</label>
          <input class="form-control" id="session-description" type="text" name="description">
        </div>
      </form>
      <button onclick="startSession()" class="btn btn-primary">
        Start new session!
      </button>
    </div>
  </div>
  <div class="container">
    <div class="row">
        {% for session in sessions %}
          <div class="col-5 card mb-3">
            <a class="card-link" href="/sessions/{{session.id}}">
              <div class="card-header">{{session.description}}</div>
            </a>
            <div class="card-body">
              <p class="card-text">Participation: {{session.entries|unique_length}} / {{session.group.users|length}}</p>
              <p class="card-text">Started at: {{session.start_time|datetimefilter}}</p>
            </div>
          </div>
        {% endfor %}
    </div>
  </div>
{% endblock %}
