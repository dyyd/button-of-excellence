<!DOCTYPE html>
<html lang="en">
<head>
    <title>Button of Excellence</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script type="text/javascript">
      function startSession() {
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            var id = xhr.response
            window.location = "/sessions/" + id;
          }
        }
        var e = document.getElementById("group-select");
        var groupId = e.options[e.selectedIndex].value

        var e = document.getElementById("context-select");
        var contextId = e.options[e.selectedIndex].value

        xhr.open('POST', '/sessions', true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
          groupId: groupId,
          contextId: contextId
        }));
      }
    </script>
</head>
<body>
    <form>
      <select id="group-select">
        {% for group in groups %}
        <option value={{group.id}}>{{group.description}}</option>
        {% endfor %}
      </select>
      <select id="context-select">
        {% for context in contexts %}
        <option value={{context.id}}>{{context.name}}</option>
        {% endfor %}
      </select>
    </form>
    <button onclick="startSession()">
      Start new session!
    </button>
    <ul id="sessions">
    {% for session in sessions %}
        <li>
          <ul>
            <li>ID: {{session.id}}</li>
            <li>Name: {{session.context.name}}</li>
            <li>Group size: {{session.group.users|length}}</li>
            <li>Started at: {{session.start_time}}</li>
            <li>Ended at: {{session.end_time}}</li>
            <li>Context: <a href="/contexts/{{session.context.id}}">{{session.context.name}}</a></li>
          </ul>
          <br>
      </li>
    {% endfor %}
    </ul>
</body>
</html>
